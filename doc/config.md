# Настройка параметров подключения к БД

[[_TOC_]]

## Подключения к БД

Установить параметры подключения можно с помощью конфигурационного файл
параметрами в разделе **database.connections**:

- type     - тип аутентификации, возможные значения:
  - md5 - по логину и паролю (по умолчанию)
    - host     - адрес СУБД, по умолчанию - 127.0.0.1
    - port     - порт СУБД, по умолчанию - 5432
    - db       - название БД, по умолчанию - ta
    - user     - имя пользователя для подключения, по умолчанию - ta
    - password - пароль для подключения, по умолчанию - 12345678
  - gss - доменная аутентификация
    - host     - адрес СУБД, по умолчанию - 127.0.0.1
    - port     - порт СУБД, по умолчанию - 5432
    - db       - название БД, по умолчанию - ta
    - user       - имя пользователя для подключения, при отсутствии используется
                   имя пользователя вошедшего в система
    - krbsrvname - имя сервиса Kerberos, предназначенное для использования при
                   аутентификации на основе GSSAPI, по умолчанию - postgres
  - uri - настройка подключения через uri
    - uri - строка подключения в формате:
            postgresql://[host][:port][/dbname]?application_name=[name]&user=[user]&password=[password]

В коде название подключение передается в конструкторе подключения.

### Пример

```yaml
database:
  connections:
    ta:
      host: 127.0.0.1
      port: 5432
      db: ta
      type: md5
      user: ta
      password: 12345678
```

```yaml
database:
  connections:
    ta:
      host: 127.0.0.1
      port: 5432
      db: ta
      type: gss
      user: ta
      krbsrvname: POSTGRES
```

```yaml
database:
  connections:
    ta:
      type: uri
      uri: postgresql://127.0.0.1:5432/ta?application_name=ta&user=ta&password=12345678
```

```c++
ta::db::pg::Connection db{"ta"};
```

## Дефолтное подключение к БД

Для установки дефолтного подключения к БД, без указания в коде программы
конкретного подключения, необходимо в конфигурационном файле в секции
**database.main** указать названия подключения. В таком случае в конструктор
подключения не передается название подключения.

```yaml
database:
  main: ta
```

```c++
tasp::db::pg::Connection db{};
```

## Пул подключений к БД

Для подключения к БД можно использовать пул подключений. Пул подключений
подключается только к основной базе, указанной в параметре **database.main**.
Параметры пула настраиваются в секции конфигурационного файла **database.pool**:

- max     - максимальное количество подключений в пуле, по умолчанию - 10
- timeout - таймаут между попытками запроса подключения, если свободные
            подключения отсутствуют, по умолчанию - 2
- retry   - количество попыток запроса подключения, если свободные подключения
            отсутствуют, по умолчанию - 3

```yaml
database:
  pool:
    max: 5
    timeout: 1
    retry: 4
```

```c++
tasp::db::pg::ConnectionPool::Instance().GetConnection();
```
